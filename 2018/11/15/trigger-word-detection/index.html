<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/hexo/images/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/hexo/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/hexo/images/favicon-16x16.png"><link rel="mask-icon" href="/hexo/images/logo.svg" color="#222"><link rel="stylesheet" href="/hexo/css/main.css"><link rel="stylesheet" href="/hexo/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"pengzhendong.github.io",root:"/hexo/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!0,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{appID:"0C48U14D5U",apiKey:"796da148bd60fa95ebae037cae6d5c16",indexName:"Notes",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="前言 花了一些时间填补了 WAV 文件的基础知识和快速傅里叶变换算法的内容。终于可以继续学习深度学习啦！前段时间买了个小米的小爱同学，用来睡前关灯还是挺方便的，这次的实验就是研究小爱同学究竟是如何被唤醒的。"><meta property="og:type" content="article"><meta property="og:title" content="触发词检测"><meta property="og:url" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/index.html"><meta property="og:site_name" content="Randy&#39;s Notes"><meta property="og:description" content="前言 花了一些时间填补了 WAV 文件的基础知识和快速傅里叶变换算法的内容。终于可以继续学习深度学习啦！前段时间买了个小米的小爱同学，用来睡前关灯还是挺方便的，这次的实验就是研究小爱同学究竟是如何被唤醒的。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/voice.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/wav.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/spectrogram.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/label_diagram.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/output1.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/model.png"><meta property="og:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/output2.png"><meta property="article:published_time" content="2018-11-15T20:16:00.000Z"><meta property="article:modified_time" content="2018-11-15T21:22:49.000Z"><meta property="article:author" content="Randy Peng"><meta property="article:tag" content="Deep Learning"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/voice.png"><link rel="canonical" href="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><style type="text/css">body{background-image:url(/images/rockywall.png)}</style><title>触发词检测 | Randy's Notes</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-92548519-1"></script><script>if(CONFIG.hostname===location.hostname){function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-92548519-1")}</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?06c54470f22c395ef480d6fb358497d5";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/hexo/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Randy's Notes</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/hexo/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/hexo/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-友链"><a href="/hexo/friends/" rel="section"><i class="fa fa-users fa-fw"></i> 友链</a></li><li class="menu-item menu-item-书单"><a href="/hexo/books/" rel="section"><i class="fa fa-book fa-fw"></i> 书单</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i> 搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div id="algolia-pagination" class="algolia-pagination"></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><a href="https://github.com/pengzhendong" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/hexo/images/avatar.jpg"><meta itemprop="name" content="Randy Peng"><meta itemprop="description" content="路漫漫其修远兮 吾将上下而求索"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Randy's Notes"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">触发词检测</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2018-11-15 20:16:00 / 修改时间：21:22:49" itemprop="dateCreated datePublished" datetime="2018-11-15T20:16:00+00:00">2018-11-15</time></span><span id="/hexo/2018/11/15/trigger-word-detection/" class="post-meta-item leancloud_visitors" data-flag-title="触发词检测" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i></span> <span class="post-meta-item-text">本文字数：</span> <span>12k</span></span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i></span> <span class="post-meta-item-text">阅读时长 &asymp;</span> <span>11 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><h2 id="前言">前言</h2><p>花了一些时间填补了 WAV 文件的基础知识和快速傅里叶变换算法的内容。终于可以继续学习深度学习啦！前段时间买了个小米的小爱同学，用来睡前关灯还是挺方便的，这次的实验就是研究小爱同学究竟是如何被唤醒的。</p><span id="more"></span><h2 id="触发词检测">触发词检测</h2><p>这次的任务是收集语音数据集并且实现触发词（也称关键字或者唤醒字）检测。举个例子：小米的小爱同学，在检测到触发词“小爱同学”后，就会被唤醒。这里的触发词是 “activate”。</p><h3 id="数据合成创建语音数据集">数据合成：创建语音数据集</h3><p>在真实场景中，还会有其他声音，例如负面词（一些其他的词）和环境背景噪声（会和触发词混合在一起出现）。很难收集大量的音频，通常都是单独下载背景噪声然后将触发词、负面词与背景噪声混合。</p><ul><li>正面词</li></ul><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/activate.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><ul><li>负面词</li></ul><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/negative.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><ul><li>背景噪声</li></ul><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/background.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><h4 id="波形图">波形图</h4><p>声音是弹性介质中压力变化形式的机械能，这些压力变化来自振动源的波传播。声音在介质中传播时，会造成介质的压缩和稀疏，从而引起原有环境压强的变化。压缩是比环境压力更高的时段，稀疏是压力低于环境压力的时段。</p><p><img src="voice.png"></p><p>波形图 (Waveform) 如上所示，总压强等于环境静态压强（即标准大气压<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="1.699ex" height="1.545ex" role="img" focusable="false" viewBox="0 -683 751 683"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637 206 637 199 638T192 648Q192 649 194 659 200 679 203 681T397 683Q587 682 600 680 664 669 707 631T751 530Q751 453 685 389 616 321 507 303 500 302 402 301H307L277 182Q247 66 247 59 247 55 248 54T255 50 272 48 305 46H336Q342 37 342 35 342 19 335 5 330 0 319 0 316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11 33 13 36 25 40 41 44 43T67 46Q94 46 127 49 141 52 146 61 149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597 609 619 560 635Q553 636 480 637 463 637 445 637T416 636 404 636Q391 635 386 627 384 621 367 550T332 412 314 344Q314 342 395 342H407 430Q542 342 590 392 617 419 631 471T645 554Z"></path></g></g></g></svg></mjx-container></span>:<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.05ex" xmlns="http://www.w3.org/2000/svg" width="3.25ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 1436.6 886"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666 297 666 345 640T423 548Q460 465 460 320 460 165 417 83 397 41 362 16T301-15 250-22Q224-22 198-16T137 16 82 83Q39 165 39 320 39 494 96 585ZM321 597Q291 629 250 629 208 629 178 597 153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16 290 16 318 46 347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mn" transform="translate(1033,393.1) scale(0.707)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22 294 22 326 82 345 115 345 210 345 313 318 349 292 382 260 382H254Q176 382 136 314 132 307 129 306T114 304Q97 304 95 310 93 314 93 485V614Q93 664 98 664 100 666 102 666 103 666 123 658T178 642 253 634Q324 634 389 662 397 666 402 666 410 666 410 648V635Q328 538 205 538 174 538 149 544L139 546V374Q158 388 169 396T205 412 256 420Q337 420 393 355T449 201Q449 109 385 44T229-22Q148-22 99 32T50 154Q50 178 61 192T84 210 107 214Q132 214 148 197T164 157Z"></path></g></g></g></g></svg></mjx-container></span>Pa）加上声音扰动带来的动态压强（即声压<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.345ex" xmlns="http://www.w3.org/2000/svg" width="2.84ex" height="1.891ex" role="img" focusable="false" viewBox="0 -683 1255.3 835.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637 206 637 199 638T192 648Q192 649 194 659 200 679 203 681T397 683Q587 682 600 680 664 669 707 631T751 530Q751 453 685 389 616 321 507 303 500 302 402 301H307L277 182Q247 66 247 59 247 55 248 54T255 50 272 48 305 46H336Q342 37 342 35 342 19 335 5 330 0 319 0 316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11 33 13 36 25 40 41 44 43T67 46Q94 46 127 49 141 52 146 61 149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597 609 619 560 635Q553 636 480 637 463 637 445 637T416 636 404 636Q391 635 386 627 384 621 367 550T332 412 314 344Q314 342 395 342H407 430Q542 342 590 392 617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(675,-152.7) scale(0.707)"><path data-c="1D434" d="M208 74Q208 50 254 46 272 46 272 35 272 34 270 22 267 8 264 4T251 0Q249 0 239 0T205 1 141 2Q70 2 50 0H42Q35 7 35 11 37 38 48 46H62Q132 49 164 96 170 102 345 401T523 704Q530 716 547 716H555 572Q578 707 578 706L606 383Q634 60 636 57 641 46 701 46 726 46 726 36 726 34 723 22 720 7 718 4T704 0Q701 0 690 0T651 1 578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260 413 259Q516 259 516 260Z"></path></g></g></g></g></svg></mjx-container></span>）。① 时段声压为 0 即为无声阶段；② 时段有声音扰动；③ 为大气压；④ 为瞬时声压。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">fs = <span class="number">44100</span></span><br><span class="line">rate, data = wavfile.read(<span class="string">'audio_examples/example_train.wav'</span>)</span><br><span class="line">time = np.linspace(<span class="number">0</span>, <span class="built_in">len</span>(data)/fs, num=<span class="built_in">len</span>(data))</span><br><span class="line">plt.xlabel(<span class="string">'time/s'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'$P_A$'</span>)</span><br><span class="line">plt.plot(time, data) </span><br><span class="line"> </span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><p><img src="wav.png"></p><p>这里的 WAV 文件使用的是 16 位量化数字，因此声压的取值范围是 (-32768, 32767)，音频时长为 10 秒。波形图看不出声音的特征，因此需要对其使用傅里叶变换，得到频谱图再分析声音的特征。</p><h2 id="波形图-1">波形图</h2><p>通过傅立叶变换可以得到信号的频谱，傅立叶变换有一个假设就是信号是平稳的，即信号的统计特性不随时间变化。声音信号就不是平稳信号，在很长的一段时间内，有很多信号会出现，然后立即消失。如果将这信号全部进行傅立叶变换，就不能反映声音随时间的变化。</p><h3 id="短时傅里叶变换">短时傅里叶变换</h3><p>声音信号虽然不是平稳信号，但在较短的一段时间内可以看作是平稳的，所以解决方案是取一小段进行傅立叶变换，即短时傅立叶变换（Short-time Fourier transform）。</p><h4 id="窗函数">窗函数</h4><p>从一段长的信号截取一段信号（通常在0.02~0.05s，称为一帧），相当于将原始信号乘以一个方窗，而方窗的傅里叶变换并不是理想的冲击函数，所以用 <code>sinc</code> 函数，<code>sinc</code> 较高的副瓣意味着在真实频点以外，副瓣的位置上的频谱也会不为零。如果在副瓣的位置上恰好有一个幅度很小的信号，就会被完全淹没。解决方案是使用窗函数，代替简单地截取一段信号，在窗的边缘，信号会乘上一个很小的数。这又会导致边缘数据并没有充分被利用，两个相邻窗之间的信号没有完全反映到频谱当中。因此解决办法是两个相邻的窗有一定的重叠，同时如果需要恢复成为时间序列，也能弥补窗函数带来的影响。总之一句话就是取一小段信号进行短时傅里叶变换会导致数据丢失，因此两个相邻的窗口之间需要有一定的重叠，重叠取加可以选择为窗长度的 50% 或者 25%。</p><h4 id="声谱图">声谱图</h4><p>语音的时域分析和频域分析是两种语音分析方法，但是这两种分析方法都有局限性。时域分析对语音信号的频率没有直观的了解，而频域分析出的特征中又没有语音信号随时间变化的关系。<strong>声谱图</strong>（语谱图）是一种三位频谱，表示语音频谱随着时间变化的图形。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">rate, data = wavfile.read(<span class="string">'audio_examples/example_train.wav'</span>)</span><br><span class="line">nfft = <span class="number">200</span>     <span class="comment"># 截取的信号长度，即窗长</span></span><br><span class="line">fs = <span class="number">44100</span>     <span class="comment"># 采样频率</span></span><br><span class="line">noverlap = <span class="number">120</span> <span class="comment"># 重叠长度</span></span><br><span class="line">pxx, freqs, bins, im = plt.specgram(data[:,<span class="number">0</span>], nfft, fs, noverlap = noverlap)</span><br></pre></td></tr></table></figure><p><img src="spectrogram.png"></p><p>横坐标为时间，纵坐标为频率。任意给定频率成分，在给定时刻的强弱用相应点的色调的浓淡来表示，颜色越深表示语音能量越强（声音更加响亮）。10 秒音频输出 <code>pxx</code> 的时间步长度为：<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-1.108ex" xmlns="http://www.w3.org/2000/svg" width="22.123ex" height="3.334ex" role="img" focusable="false" viewBox="0 -983.5 9778.2 1473.4"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22 294 22 326 82 345 115 345 210 345 313 318 349 292 382 260 382H254Q176 382 136 314 132 307 129 306T114 304Q97 304 95 310 93 314 93 485V614Q93 664 98 664 100 666 102 666 103 666 123 658T178 642 253 634Q324 634 389 662 397 666 402 666 410 666 410 648V635Q328 538 205 538 174 538 149 544L139 546V374Q158 388 169 396T205 412 256 420Q337 420 393 355T449 201Q449 109 385 44T229-22Q148-22 99 32T50 154Q50 178 61 192T84 210 107 214Q132 214 148 197T164 157Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22 294 22 326 82 345 115 345 210 345 313 318 349 292 382 260 382H254Q176 382 136 314 132 307 129 306T114 304Q97 304 95 310 93 314 93 485V614Q93 664 98 664 100 666 102 666 103 666 123 658T178 642 253 634Q324 634 389 662 397 666 402 666 410 666 410 648V635Q328 538 205 538 174 538 149 544L139 546V374Q158 388 169 396T205 412 256 420Q337 420 393 355T449 201Q449 109 385 44T229-22Q148-22 99 32T50 154Q50 178 61 192T84 210 107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z" transform="translate(1000,0)"></path><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z" transform="translate(1500,0)"></path></g><g data-mml-node="mo" transform="translate(2277.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(3333.6,0)"><g data-mml-node="mrow" transform="translate(368.5,485) scale(0.707)"><g data-mml-node="mn"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666 297 666 345 640T423 548Q460 465 460 320 460 165 417 83 397 41 362 16T301-15 250-22Q224-22 198-16T137 16 82 83Q39 165 39 320 39 494 96 585ZM321 597Q291 629 250 629 208 629 178 597 153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16 290 16 318 46 347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(1000,0)"><path data-c="D7" d="M630 29Q630 9 609 9 604 9 587 25T493 118L389 222 284 117Q178 13 175 11 171 9 168 9 160 9 154 15T147 29Q147 36 161 51T255 146L359 250 255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489 178 487 284 383L389 278 493 382Q570 459 587 475T609 491Q630 491 630 471 630 464 620 453T522 355L418 250 522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mi" transform="translate(1778,0)"><path data-c="1D453" d="M118-162Q120-162 124-164T135-167 147-168Q160-168 171-155T187-126Q197-99 221 27T267 267 289 382V385H242Q195 385 192 387 188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432 298 434 307 482T319 540Q356 705 465 705 502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603 443 622 454 636T478 657L487 662Q471 668 457 668 445 668 434 658T419 630Q412 601 403 552T387 469 380 433Q380 431 435 431 480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282-47 255-132 212-173 175-205 139-205 107-205 81-186T55-132Q55-95 76-78T118-61Q162-61 162-103 162-122 151-136T127-157L118-162Z"></path></g><g data-mml-node="mi" transform="translate(2328,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415 300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372 367 378Q368 378 368 379 368 382 361 388T336 399 297 405Q249 405 227 379T204 326Q204 301 223 291T278 274 330 259Q396 230 396 163 396 135 385 107T352 51 289 7 195-10Q118-10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34 201 27Q237 27 263 38T301 66 318 97 323 122Q323 150 302 164T254 181 195 196 148 231Q131 256 131 289Z"></path></g><g data-mml-node="mo" transform="translate(2797,0)"><path data-c="2212" d="M84 237T84 250 98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(3575,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341 56 388 89 425 135 442Q171 442 195 424T225 390 231 369Q231 367 232 367L243 378Q304 442 382 442 436 442 469 415T503 336 465 179 427 52Q427 26 444 26 450 26 453 27 482 32 505 65T540 145Q542 153 560 153 580 153 580 145 580 144 576 130 568 101 554 73T508 17 439-10Q392-10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291 189 157Q156 26 151 16 138-11 108-11 95-11 87-5T76 7 74 17Q74 30 112 180T152 343Q153 348 153 366 153 405 129 405 91 405 66 305 60 285 60 284 58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4175,0)"><path data-c="1D453" d="M118-162Q120-162 124-164T135-167 147-168Q160-168 171-155T187-126Q197-99 221 27T267 267 289 382V385H242Q195 385 192 387 188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432 298 434 307 482T319 540Q356 705 465 705 502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603 443 622 454 636T478 657L487 662Q471 668 457 668 445 668 434 658T419 630Q412 601 403 552T387 469 380 433Q380 431 435 431 480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282-47 255-132 212-173 175-205 139-205 107-205 81-186T55-132Q55-95 76-78T118-61Q162-61 162-103 162-122 151-136T127-157L118-162Z"></path></g><g data-mml-node="mi" transform="translate(4725,0)"><path data-c="1D453" d="M118-162Q120-162 124-164T135-167 147-168Q160-168 171-155T187-126Q197-99 221 27T267 267 289 382V385H242Q195 385 192 387 188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432 298 434 307 482T319 540Q356 705 465 705 502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603 443 622 454 636T478 657L487 662Q471 668 457 668 445 668 434 658T419 630Q412 601 403 552T387 469 380 433Q380 431 435 431 480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282-47 255-132 212-173 175-205 139-205 107-205 81-186T55-132Q55-95 76-78T118-61Q162-61 162-103 162-122 151-136T127-157L118-162Z"></path></g><g data-mml-node="mi" transform="translate(5275,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341 56 388 89 425 135 442Q171 442 195 424T225 390 231 369Q231 367 232 367L243 378Q304 442 382 442 436 442 469 415T503 336 465 179 427 52Q427 26 444 26 450 26 453 27 482 32 505 65T540 145Q542 153 560 153 580 153 580 145 580 144 576 130 568 101 554 73T508 17 439-10Q392-10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291 189 157Q156 26 151 16 138-11 108-11 95-11 87-5T76 7 74 17Q74 30 112 180T152 343Q153 348 153 366 153 405 129 405 91 405 66 305 60 285 60 284 58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600,0)"><path data-c="1D453" d="M118-162Q120-162 124-164T135-167 147-168Q160-168 171-155T187-126Q197-99 221 27T267 267 289 382V385H242Q195 385 192 387 188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432 298 434 307 482T319 540Q356 705 465 705 502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603 443 622 454 636T478 657L487 662Q471 668 457 668 445 668 434 658T419 630Q412 601 403 552T387 469 380 433Q380 431 435 431 480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282-47 255-132 212-173 175-205 139-205 107-205 81-186T55-132Q55-95 76-78T118-61Q162-61 162-103 162-122 151-136T127-157L118-162Z"></path></g><g data-mml-node="mi" transform="translate(1150,0)"><path data-c="1D453" d="M118-162Q120-162 124-164T135-167 147-168Q160-168 171-155T187-126Q197-99 221 27T267 267 289 382V385H242Q195 385 192 387 188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432 298 434 307 482T319 540Q356 705 465 705 502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603 443 622 454 636T478 657L487 662Q471 668 457 668 445 668 434 658T419 630Q412 601 403 552T387 469 380 433Q380 431 435 431 480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282-47 255-132 212-173 175-205 139-205 107-205 81-186T55-132Q55-95 76-78T118-61Q162-61 162-103 162-122 151-136T127-157L118-162Z"></path></g><g data-mml-node="mi" transform="translate(1700,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(2061,0)"><path data-c="2212" d="M84 237T84 250 98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2839,0)"><path data-c="1D45C" d="M201-11Q126-11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441 333 441 341 440 354 437 367 433T402 417 438 387 464 338 476 268Q476 161 390 75T201-11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375 346 405 306 405 243 405 195 347 158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3324,0)"><path data-c="1D463" d="M173 380Q173 405 154 405 130 405 104 376T61 287Q60 286 59 284T58 281 56 279 53 278 49 278 41 278H27Q21 284 21 287 21 294 29 316T53 368 97 419 160 441Q202 441 225 417T249 361Q249 344 246 335 246 329 231 291T200 202 182 113Q182 86 187 69 200 26 250 26 287 26 319 60T369 139 398 222 409 277Q409 300 401 317T383 343 365 361 357 383Q357 405 376 424T417 443Q436 443 451 425T467 367Q467 340 455 284T418 159 347 40 241-11Q177-11 139 22 102 54 102 117 102 148 110 181T151 298Q173 362 173 380Z"></path></g><g data-mml-node="mi" transform="translate(3809,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350 174 402 244 433 307 442H310Q355 442 388 420T421 355Q421 265 310 237 261 224 176 223 139 223 138 221 138 219 132 186T125 128Q125 81 146 54T209 26 302 45 394 111Q403 121 406 121 410 121 419 112T429 98 420 82 390 55 344 24 281-1 205-11Q126-11 83 42T39 168ZM373 353Q367 405 305 405 272 405 244 391T199 357 170 316 154 280 149 261Q149 260 169 260 282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(4275,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317 38 348 53 381 73 411 99 433 132 442Q161 442 183 430T214 408 225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400 430 381 430 363 430 333 417 315T391 292 366 288Q346 288 334 299T322 328Q322 376 378 392 356 405 342 405 286 405 239 331 229 315 224 298T190 165Q156 25 151 16 138-11 108-11 95-11 87-5T76 7 74 17Q74 30 114 189T154 366Q154 405 128 405 107 405 92 377T68 316 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4726,0)"><path data-c="1D459" d="M117 59Q117 26 142 26 179 26 205 131 211 151 215 152 217 153 225 153H229Q238 153 241 153T246 151 248 144Q247 138 245 128T234 90 214 43 183 6 137-11Q101-11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623 167 626 166 628T162 632 157 634 149 635 141 636 132 637 122 637Q112 637 109 637T101 638 95 641 94 647Q94 649 96 661 101 680 107 682T179 688Q194 689 213 690T243 693 254 694Q266 694 266 686 266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path></g><g data-mml-node="mi" transform="translate(5024,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392 386 422 416 422 429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35 443 55 463 131 469 151 473 152 475 153 483 153H487Q506 153 506 144 506 138 501 117T481 63 449 13Q436 0 417-8 409-10 393-10 359-10 336 5T306 36L300 51Q299 52 296 50 294 48 292 46 233-10 172-10 117-10 75 30T33 157ZM351 328Q351 334 346 350T323 385 277 405Q242 405 210 374T160 293Q131 214 119 129 119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(5553,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317 40 348 55 381 75 411 101 433 134 442Q209 442 230 378L240 387Q302 442 358 442 423 442 460 395T497 281Q497 173 421 82T249-10Q227-10 210-4 199 1 187 11T168 28L161 36Q160 35 139-51T118-138Q118-144 126-145T163-148H188Q194-155 194-157T191-175Q188-187 185-190T172-194Q170-194 161-194T127-193 65-192Q-5-192-24-194H-32Q-39-187-39-183-37-156-26-148H-6Q28-147 33-136 36-130 94 103T155 350Q156 355 156 364 156 405 131 405 109 405 94 377T71 316 59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26 282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405 339 405 328 402T306 393 286 380 269 365 254 350 243 336 235 326L232 322Q232 321 229 308T218 264 204 212Q178 106 178 102Z"></path></g></g><rect width="4482.2" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8278,0)"><path data-c="2B" d="M56 237T56 250 70 270H369V420L370 570Q380 583 389 583 402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401-82 391-82H389 387Q375-82 369-68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(9278.2,0)"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path></g></g></g></svg></mjx-container></span>，在原始音频中一共有 441000 个时间步，而在声谱图中一共有 5511 个时间步，因此前者每个时间步代表 0.000023 秒，后者代表 0.0018 秒。也就是说 10 秒的时间可以被离散成不同的数值，例如 GRU 的输出离散成 1375 个时间步，也就是每个时间步 0.0072 秒，模型的输出就表示这个 0.0072 秒内是否有人说过触发词。</p><h2 id="生成训练示例">生成训练示例</h2><p>为了合成一个训练样本，需要：</p><ul><li>随机选择一个 10 秒的背景音频剪辑</li><li>随机将 0-4 个正面音频片段插入此 10 秒剪辑中</li><li>随机将 0-2 个反面音频片段插入此 10 秒剪辑中</li></ul><p>通常使用 <code>pydub</code> 来处理音频。 Pydub 将原始音频文件转换为 Pydub 数据结构列表，使用 1ms 作为离散化间隔，因此 10 秒剪辑一共有 10,000 个时间步。我们希望在背景噪声中插入多个触发词和负面，同时不希望这些词重叠（声音合成而不是声音拼接，最终输出音频还是 10 秒）。</p><p>首先初始化背景噪声的标签，因为里面还没有触发词，所以对于所有的<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.025ex" xmlns="http://www.w3.org/2000/svg" width="0.817ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 361 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g></g></g></svg></mjx-container></span>，有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="7.267ex" height="2.485ex" role="img" focusable="false" viewBox="0 -893.3 3212 1098.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(750,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1656.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2712,0)"><path data-c="30" d="M96 585Q152 666 249 666 297 666 345 640T423 548Q460 465 460 320 460 165 417 83 397 41 362 16T301-15 250-22Q224-22 198-16T137 16 82 83Q39 165 39 320 39 494 96 585ZM321 597Q291 629 250 629 208 629 178 597 153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16 290 16 318 46 347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container></span>。在插入触发词的时候，还需要更新标签<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="3.119ex" height="2.485ex" role="img" focusable="false" viewBox="0 -893.3 1378.4 1098.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(750,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g></g></g></svg></mjx-container></span>。假设在第 5 秒的时候插入了触发词（即输出的第<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.816ex" xmlns="http://www.w3.org/2000/svg" width="21.012ex" height="2.773ex" role="img" focusable="false" viewBox="0 -864.9 9287.1 1225.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601 351 623 311 626 240 626 194 566 147 500 147 364L148 360Q153 366 156 373 197 433 263 433H267Q313 433 348 414 372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149 440 90 387 34T253-22Q225-22 199-14T143 16 92 75 56 172 42 313ZM257 397Q227 397 205 380T171 335 154 278 148 216Q148 133 160 97T198 39Q222 21 251 21 302 21 329 59 342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="38" d="M70 417T70 494 124 618 248 666Q319 666 374 624T429 515Q429 485 418 459T392 417 361 389 335 371 324 363L338 354Q352 344 366 334T382 323Q457 264 457 174 457 95 399 37T249-22Q159-22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368 70 417 70 494ZM286 386 292 390Q298 394 301 396T311 403 323 413 334 425 345 438 355 454 364 471 369 491 371 513Q371 556 342 586T275 624Q268 625 242 625 201 625 165 599T128 534Q128 511 141 492T167 463 217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194 353 216 330 234 301 253 274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239 107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646 364 644H485V605L417 512Q408 500 387 472T360 435 339 403 319 367 305 330 292 284 284 230 278 162 275 80Q275 66 275 52T274 28V19Q270 2 255-10T221-22Q210-22 200-19T179 0 168 40Q168 198 265 368 285 400 349 489L395 552H302Q128 552 119 546 113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(1777.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(2833.6,0)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369 98 420 158 442Q197 442 223 419T250 357Q250 340 236 301T196 196 154 83Q149 61 149 51 149 26 166 26 175 26 185 29T208 43 235 78 260 137Q263 149 265 151T282 153Q302 153 302 143 302 135 293 112T268 61 223 11 161-11Q129-11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281 56 279 53 278 49 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3178.6,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341 56 388 89 425 135 442Q171 442 195 424T225 390 231 369Q231 367 232 367L243 378Q304 442 382 442 436 442 469 415T503 336 465 179 427 52Q427 26 444 26 450 26 453 27 482 32 505 65T540 145Q542 153 560 153 580 153 580 145 580 144 576 130 568 101 554 73T508 17 439-10Q392-10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291 189 157Q156 26 151 16 138-11 108-11 95-11 87-5T76 7 74 17Q74 30 112 180T152 343Q153 348 153 366 153 405 129 405 91 405 66 305 60 285 60 284 58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3778.6,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(4139.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488 164 576 202 643 244 695 277 729 302 750H315 319Q333 750 333 741 333 738 316 720T275 667 226 581 184 443 167 250 184 58 225-81 274-167 316-220 333-241Q333-250 318-250H315 302L274-226Q180-141 137-14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(4528.6,0)"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664 351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336 375 315Q457 262 457 175 457 96 395 37T238-22Q158-22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94 148 82 136 74 126 70 118 67L114 66Q165 21 238 21 293 21 321 74 338 107 338 175V195Q338 290 274 322 259 328 213 329L171 330 168 332Q166 335 166 348 166 366 174 366 202 366 232 371 266 376 294 413T322 525V533Q322 590 287 612 265 626 240 626 208 626 181 615T143 592 132 580H135Q138 579 143 578T153 573 165 566 175 555 183 540 186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646 364 644H485V605L417 512Q408 500 387 472T360 435 339 403 319 367 305 330 292 284 284 230 278 162 275 80Q275 66 275 52T274 28V19Q270 2 255-10T221-22Q210-22 200-19T179 0 168 40Q168 198 265 368 285 400 349 489L395 552H302Q128 552 119 546 113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1000,0)"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22 294 22 326 82 345 115 345 210 345 313 318 349 292 382 260 382H254Q176 382 136 314 132 307 129 306T114 304Q97 304 95 310 93 314 93 485V614Q93 664 98 664 100 666 102 666 103 666 123 658T178 642 253 634Q324 634 389 662 397 666 402 666 410 666 410 648V635Q328 538 205 538 174 538 149 544L139 546V374Q158 388 169 396T205 412 256 420Q337 420 393 355T449 201Q449 109 385 44T229-22Q148-22 99 32T50 154Q50 178 61 192T84 210 107 214Q132 214 148 197T164 157Z" transform="translate(1500,0)"></path></g><g data-mml-node="mo" transform="translate(6750.8,0)"><path data-c="D7" d="M630 29Q630 9 609 9 604 9 587 25T493 118L389 222 284 117Q178 13 175 11 171 9 168 9 160 9 154 15T147 29Q147 36 161 51T255 146L359 250 255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489 178 487 284 383L389 278 493 382Q570 459 587 475T609 491Q630 491 630 471 630 464 620 453T522 355L418 250 522 145Q606 61 618 48T630 29Z"></path></g><g data-mml-node="mfrac" transform="translate(7751,0)"><g data-mml-node="mn" transform="translate(396.8,394) scale(0.707)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22 294 22 326 82 345 115 345 210 345 313 318 349 292 382 260 382H254Q176 382 136 314 132 307 129 306T114 304Q97 304 95 310 93 314 93 485V614Q93 664 98 664 100 666 102 666 103 666 123 658T178 642 253 634Q324 634 389 662 397 666 402 666 410 666 410 648V635Q328 538 205 538 174 538 149 544L139 546V374Q158 388 169 396T205 412 256 420Q337 420 393 355T449 201Q449 109 385 44T229-22Q148-22 99 32T50 154Q50 178 61 192T84 210 107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mn" transform="translate(220,-345) scale(0.707)"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path><path data-c="30" d="M96 585Q152 666 249 666 297 666 345 640T423 548Q460 465 460 320 460 165 417 83 397 41 362 16T301-15 250-22Q224-22 198-16T137 16 82 83Q39 165 39 320 39 494 96 585ZM321 597Q291 629 250 629 208 629 178 597 153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16 290 16 318 46 347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><rect width="907.1" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(8898.1,0)"><path data-c="29" d="M60 749 64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12 224-76 186-143 145-194 113-227 90-246Q87-249 86-250H74Q66-250 63-250T58-247 55-238Q56-237 66-225 221-64 221 250T66 725Q56 737 55 738 55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>个时间步），那么我们希望模型在接下来一小段时间内能检测到就行，我们选择 50 个时间步，也就是<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="30.673ex" height="2.485ex" role="img" focusable="false" viewBox="0 -893.3 13557.6 1098.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601 351 623 311 626 240 626 194 566 147 500 147 364L148 360Q153 366 156 373 197 433 263 433H267Q313 433 348 414 372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149 440 90 387 34T253-22Q225-22 199-14T143 16 92 75 56 172 42 313ZM257 397Q227 397 205 380T171 335 154 278 148 216Q148 133 160 97T198 39Q222 21 251 21 302 21 329 59 342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="38" d="M70 417T70 494 124 618 248 666Q319 666 374 624T429 515Q429 485 418 459T392 417 361 389 335 371 324 363L338 354Q352 344 366 334T382 323Q457 264 457 174 457 95 399 37T249-22Q159-22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368 70 417 70 494ZM286 386 292 390Q298 394 301 396T311 403 323 413 334 425 345 438 355 454 364 471 369 491 371 513Q371 556 342 586T275 624Q268 625 242 625 201 625 165 599T128 534Q128 511 141 492T167 463 217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194 353 216 330 234 301 253 274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239 107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path><path data-c="38" d="M70 417T70 494 124 618 248 666Q319 666 374 624T429 515Q429 485 418 459T392 417 361 389 335 371 324 363L338 354Q352 344 366 334T382 323Q457 264 457 174 457 95 399 37T249-22Q159-22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368 70 417 70 494ZM286 386 292 390Q298 394 301 396T311 403 323 413 334 425 345 438 355 454 364 471 369 491 371 513Q371 556 342 586T275 624Q268 625 242 625 201 625 165 599T128 534Q128 511 141 492T167 463 217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194 353 216 330 234 301 253 274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239 107 157Q107 98 150 60T250 21Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2461.6,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(3517.3,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601 351 623 311 626 240 626 194 566 147 500 147 364L148 360Q153 366 156 373 197 433 263 433H267Q313 433 348 414 372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149 440 90 387 34T253-22Q225-22 199-14T143 16 92 75 56 172 42 313ZM257 397Q227 397 205 380T171 335 154 278 148 216Q148 133 160 97T198 39Q222 21 251 21 302 21 329 59 342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path data-c="38" d="M70 417T70 494 124 618 248 666Q319 666 374 624T429 515Q429 485 418 459T392 417 361 389 335 371 324 363L338 354Q352 344 366 334T382 323Q457 264 457 174 457 95 399 37T249-22Q159-22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368 70 417 70 494ZM286 386 292 390Q298 394 301 396T311 403 323 413 334 425 345 438 355 454 364 471 369 491 371 513Q371 556 342 586T275 624Q268 625 242 625 201 625 165 599T128 534Q128 511 141 492T167 463 217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194 353 216 330 234 301 253 274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239 107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path><path data-c="39" d="M352 287Q304 211 232 211 154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606 171 666 243 666 245 666 249 666T257 665H261Q273 665 286 663T323 651 370 619 413 560Q456 472 456 334 456 194 396 97 361 41 312 10T208-22Q147-22 108 7T68 93 121 149Q143 149 158 135T173 96Q173 78 164 65T148 49 135 44L131 43Q131 41 138 37T164 27 206 22H212Q272 22 313 86 352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542 341 552 337 562T323 588 293 615 246 625Q208 625 181 598 160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g><g data-mml-node="mo" transform="translate(5978.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(7034.7,0)"><path data-c="22EF" d="M78 250Q78 274 95 292T138 310Q162 310 180 294T199 251Q199 226 182 208T139 190 96 207 78 250ZM525 250Q525 274 542 292T585 310Q609 310 627 294T646 251Q646 226 629 208T586 190 543 207 525 250ZM972 250Q972 274 989 292T1032 310Q1056 310 1074 294T1093 251Q1093 226 1076 208T1033 190 990 207 972 250Z"></path></g><g data-mml-node="mo" transform="translate(8484.5,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(9540.2,0)"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646 364 644H485V605L417 512Q408 500 387 472T360 435 339 403 319 367 305 330 292 284 284 230 278 162 275 80Q275 66 275 52T274 28V19Q270 2 255-10T221-22Q210-22 200-19T179 0 168 40Q168 198 265 368 285 400 349 489L395 552H302Q128 552 119 546 113 543 108 522T98 479L95 458V455H55V458Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664 351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336 375 315Q457 262 457 175 457 96 395 37T238-22Q158-22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94 148 82 136 74 126 70 118 67L114 66Q165 21 238 21 293 21 321 74 338 107 338 175V195Q338 290 274 322 259 328 213 329L171 330 168 332Q166 335 166 348 166 366 174 366 202 366 232 371 266 376 294 413T322 525V533Q322 590 287 612 265 626 240 626 208 626 181 615T143 592 132 580H135Q138 579 143 578T153 573 165 566 175 555 183 540 186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646 364 644H485V605L417 512Q408 500 387 472T360 435 339 403 319 367 305 330 292 284 284 230 278 162 275 80Q275 66 275 52T274 28V19Q270 2 255-10T221-22Q210-22 200-19T179 0 168 40Q168 198 265 368 285 400 349 489L395 552H302Q128 552 119 546 113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(1000,0)"></path></g><g data-mml-node="mo" transform="translate(1889,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g><g data-mml-node="mo" transform="translate(12001.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347 722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153 722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(13057.6,0)"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path></g></g></g></svg></mjx-container></span>。如下图所示，每个触发词后 50 个时间步的标签都是 1：</p><p><img src="label_diagram.png"></p><p>合成训练数据还有一个好处就是容易生成标签，如果在录制声音的时候手动标记是非常耗时的。</p><h3 id="辅助函数">辅助函数</h3><p>为了实现训练集的合成，还需要以下辅助函数，这些函数都使用 1 毫秒离散化间隔，即 10 秒的音频总是被离散化成 10,000 步。</p><ol type="1"><li><p><code>get_random_time_segment(segment_ms)</code> 从背景音频中选择指定长度的随机时间片段；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_random_time_segment</span>(<span class="params">segment_ms</span>):</span><br><span class="line">    segment_start = np.random.randint(low=<span class="number">0</span>, high=<span class="number">10000</span>-segment_ms) <span class="comment"># 防止超出 10s</span></span><br><span class="line">    segment_end = segment_start + segment_ms - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> (segment_start, segment_end)</span><br></pre></td></tr></table></figure></li><li><p><code>is_overlapping(segment_time, existing_segments)</code> 判断时间片是否与先前的时间片重叠；</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_overlapping</span>(<span class="params">segment_time, previous_segments</span>):</span><br><span class="line">    segment_start, segment_end = segment_time</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 1: Initialize overlap as a "False" flag.</span></span><br><span class="line">    overlap = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 2: loop over the previous_segments start and end times.</span></span><br><span class="line">    <span class="comment"># Compare start/end times and set the flag to True if there is an overlap.</span></span><br><span class="line">    <span class="keyword">for</span> previous_start, previous_end <span class="keyword">in</span> previous_segments:</span><br><span class="line">        <span class="keyword">if</span> segment_start &lt;= previous_end <span class="keyword">and</span> segment_end &gt;= previous_start:</span><br><span class="line">            overlap = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> overlap</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">overlap1 = is_overlapping((<span class="number">950</span>, <span class="number">1430</span>), [(<span class="number">2000</span>, <span class="number">2550</span>), (<span class="number">260</span>, <span class="number">949</span>)])</span><br><span class="line">overlap2 = is_overlapping((<span class="number">2305</span>, <span class="number">2950</span>), [(<span class="number">824</span>, <span class="number">1532</span>), (<span class="number">1900</span>, <span class="number">2305</span>), (<span class="number">3424</span>, <span class="number">3656</span>)])</span><br><span class="line">assertFalse(overlap1)</span><br><span class="line">assertTrue(overlap2)</span><br></pre></td></tr></table></figure></li><li><p><code>insert_audio_clip(background, audio_clip, existing_times)</code> 使用上述两个辅助函数在背景音频的随机时间处插入一个音频时间片，需要完成 4 步：</p><ol type="1"><li>以毫秒为单位随机选择时间片；</li><li>确保时间片与先前的时间片都不重叠，否则返回上一个步骤重新选择时间片；</li><li>将新时间片添加到现有时间片列表中，以跟踪插入的所有时间片；</li><li>使用 pydub 将音频重叠在背景噪声中（使用 overlay 函数）。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">insert_audio_clip</span>(<span class="params">background, audio_clip, previous_segments</span>):</span><br><span class="line">    <span class="comment"># Get the duration of the audio clip in ms</span></span><br><span class="line">    segment_ms = <span class="built_in">len</span>(audio_clip)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 1: Use one of the helper functions to pick a random time segment onto which to insert </span></span><br><span class="line">    <span class="comment"># the new audio clip. (≈ 1 line)</span></span><br><span class="line">    segment_time = get_random_time_segment(segment_ms)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 2: Check if the new segment_time overlaps with one of the previous_segments. If so, keep </span></span><br><span class="line">    <span class="comment"># picking new segment_time at random until it doesn't overlap. (≈ 2 lines)</span></span><br><span class="line">    <span class="keyword">while</span> is_overlapping(segment_time, previous_segments):</span><br><span class="line">        segment_time = get_random_time_segment(segment_ms)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 3: Add the new segment_time to the list of previous_segments (≈ 1 line)</span></span><br><span class="line">    previous_segments.append(segment_time)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 4: Superpose audio segment and background</span></span><br><span class="line">    new_background = background.overlay(audio_clip, position = segment_time[<span class="number">0</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> new_background, segment_time</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">5</span>)</span><br><span class="line">audio_clip, segment_time = insert_audio_clip(backgrounds[<span class="number">0</span>], activates[<span class="number">0</span>], [(<span class="number">3790</span>, <span class="number">4400</span>)])</span><br><span class="line">audio_clip.export(<span class="string">"insert_test.wav"</span>, <span class="built_in">format</span>=<span class="string">"wav"</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Segment Time: "</span>, segment_time)</span><br><span class="line">IPython.display.Audio(<span class="string">"insert_test.wav"</span>)</span><br></pre></td></tr></table></figure></li></ol><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/insert_test.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><ol start="4" type="1"><li><p><code>insert_ones(y, segment_end_ms)</code> 在 ”activate” 之后插入 1 到标签向量<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">insert_ones</span>(<span class="params">y, segment_end_ms</span>):</span><br><span class="line">    <span class="comment"># duration of the background (in terms of spectrogram time-steps)</span></span><br><span class="line">    segment_end_y = <span class="built_in">int</span>(segment_end_ms * Ty / <span class="number">10000.0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Add 1 to the correct index in the background label (y)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(segment_end_y + <span class="number">1</span>, segment_end_y + <span class="number">51</span>):</span><br><span class="line">        <span class="keyword">if</span> i &lt; Ty:</span><br><span class="line">            y[<span class="number">0</span>, i] = <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><p>注意标签一共有 1375 个时间步，因此不能越界。测试一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr1 = insert_ones(np.zeros((<span class="number">1</span>, Ty)), <span class="number">9700</span>)</span><br><span class="line">plt.plot(insert_ones(arr1, <span class="number">4251</span>)[<span class="number">0</span>,:])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"sanity checks:"</span>, arr1[<span class="number">0</span>][<span class="number">1333</span>], arr1[<span class="number">0</span>][<span class="number">634</span>], arr1[<span class="number">0</span>][<span class="number">635</span>])</span><br></pre></td></tr></table></figure><p>sanity checks: 0.0 1.0 0.0</p><p><img src="output1.png"></p></li></ol><h3 id="生成训练样本">生成训练样本</h3><p>实现 <code>create_training_example()</code> 来生成所有训练样本：</p><ol type="1"><li>将标签向量<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>初始化为零值的<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.667ex" xmlns="http://www.w3.org/2000/svg" width="7.447ex" height="2.364ex" role="img" focusable="false" viewBox="0 -750 3291.5 1045"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488 164 576 202 643 244 695 277 729 302 750H315 319Q333 750 333 741 333 738 316 720T275 667 226 581 184 443 167 250 184 58 225-81 274-167 316-220 333-241Q333-250 318-250H315 302L274-226Q180-141 137-14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578 200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641 273 663Q275 666 285 666 294 666 302 660V361L303 61Q310 54 315 52T339 48 401 46H427V0H416Q395 3 257 3 121 3 100 0H88V46H114Q136 46 152 46T177 47 193 50 201 52 207 57 213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(889,0)"><text data-variant="italic" transform="scale(1,-1)" font-size="884px" font-family="serif" font-style="italic">，</text></g><g data-mml-node="msub" transform="translate(1889,0)"><g data-mml-node="mi"><path data-c="1D447" d="M40 437Q21 437 21 445 21 450 37 501T71 602L88 651Q93 669 101 677H569 659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437 640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631 469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46 418 46 427 45T436 36Q436 31 433 22 429 4 424 1L422 0Q419 0 415 0 410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83 94Q174 46 189 55 190 56 191 56 196 59 201 76T241 233Q258 301 269 344 339 619 339 625 339 630 310 630H279Q212 630 191 624 146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g><g data-mml-node="mi" transform="translate(617,-150) scale(0.707)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mo" transform="translate(2902.5,0)"><path data-c="29" d="M60 749 64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12 224-76 186-143 145-194 113-227 90-246Q87-249 86-250H74Q66-250 63-250T58-247 55-238Q56-237 66-225 221-64 221 250T66 725Q56 737 55 738 55 746 60 749Z"></path></g></g></g></svg></mjx-container></span>numpy 数组；</li><li>将已存在时间片集合初始化为空列表；</li><li>随机选择 0 至 4 个 “activate” 音频剪辑，并将其插入 10 秒剪辑，记着将标签插入标签向量<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="1.109ex" height="1.464ex" role="img" focusable="false" viewBox="0 -442 490 647"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g></g></g></svg></mjx-container></span>中的正确位置；</li><li>随机选择 0 到 2 个负面音频片段，并将它们插入 10 秒片段。</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_training_example</span>(<span class="params">background, activates, negatives</span>):</span><br><span class="line">    <span class="comment"># Set the random seed</span></span><br><span class="line">    np.random.seed(<span class="number">18</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Make background quieter</span></span><br><span class="line">    background = background - <span class="number">20</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 1: Initialize y (label vector) of zeros (≈ 1 line)</span></span><br><span class="line">    y = np.zeros((<span class="number">1</span>, Ty))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 2: Initialize segment times as empty list (≈ 1 line)</span></span><br><span class="line">    previous_segments = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Select 0-4 random "activate" audio clips from the entire list of "activates" recordings</span></span><br><span class="line">    number_of_activates = np.random.randint(<span class="number">0</span>, <span class="number">5</span>)</span><br><span class="line">    random_indices = np.random.randint(<span class="built_in">len</span>(activates), size=number_of_activates)</span><br><span class="line">    random_activates = [activates[i] <span class="keyword">for</span> i <span class="keyword">in</span> random_indices]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 3: Loop over randomly selected "activate" clips and insert in background</span></span><br><span class="line">    <span class="keyword">for</span> random_activate <span class="keyword">in</span> random_activates:</span><br><span class="line">        <span class="comment"># Insert the audio clip on the background</span></span><br><span class="line">        background, segment_time = insert_audio_clip(background, random_activate, previous_segments)</span><br><span class="line">        <span class="comment"># Retrieve segment_start and segment_end from segment_time</span></span><br><span class="line">        segment_start, segment_end = segment_time</span><br><span class="line">        <span class="comment"># Insert labels in "y"</span></span><br><span class="line">        y = insert_ones(y, segment_end_ms=segment_end)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Select 0-2 random negatives audio recordings from the entire list of "negatives" recordings</span></span><br><span class="line">    number_of_negatives = np.random.randint(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">    random_indices = np.random.randint(<span class="built_in">len</span>(negatives), size=number_of_negatives)</span><br><span class="line">    random_negatives = [negatives[i] <span class="keyword">for</span> i <span class="keyword">in</span> random_indices]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 4: Loop over randomly selected negative clips and insert in background</span></span><br><span class="line">    <span class="keyword">for</span> random_negative <span class="keyword">in</span> random_negatives:</span><br><span class="line">        <span class="comment"># Insert the audio clip on the background </span></span><br><span class="line">        background, _ = insert_audio_clip(background, random_negative, previous_segments)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Standardize the volume of the audio clip </span></span><br><span class="line">    background = match_target_amplitude(background, -<span class="number">20.0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Export new training example </span></span><br><span class="line">    file_handle = background.export(<span class="string">"train"</span> + <span class="string">".wav"</span>, <span class="built_in">format</span>=<span class="string">"wav"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"File (train.wav) was saved in your directory."</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><h2 id="开发测试集">开发测试集</h2><p>为了测试模型，实验记录了 25 个样本的开发集。虽然训练数据是合成的，但是开发集应该与实际输入具有相同的分布，因此实验手工标记了 25 个 10 秒钟的音频剪辑。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Load preprocessed training examples</span></span><br><span class="line">X = np.load(<span class="string">"./XY_train/X.npy"</span>)</span><br><span class="line">Y = np.load(<span class="string">"./XY_train/Y.npy"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Load preprocessed dev set examples</span></span><br><span class="line">X_dev = np.load(<span class="string">"./XY_dev/X_dev.npy"</span>)</span><br><span class="line">Y_dev = np.load(<span class="string">"./XY_dev/Y_dev.npy"</span>)</span><br></pre></td></tr></table></figure><h2 id="模型">模型</h2><p>实验模型使用一维的卷积层、GRU 层和全连接层，首先载入相关的包：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ModelCheckpoint</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model, load_model, Sequential</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, Activation, Dropout, Input, Masking, TimeDistributed, LSTM, Conv1D</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> GRU, Bidirectional, BatchNormalization, Reshape</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> Adam</span><br></pre></td></tr></table></figure><h3 id="构建模型">构建模型</h3><p>模型结构如下图所示：</p><p><img src="model.png"></p><p>该模型的一个关键步骤是一维卷积步骤，它的输入是 5511 个时间步的频谱，然后输出一个 1375 个时间步的输出。从计算的角度而言，卷积层有助于加速模型，经过卷积层后 GRU 仅处理 1375 个时间步而不是 5511 个时间步。两层 GRU 从左往右读入绪论，然后使用全连接神经网络加 Sigmoid 层对<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:-.464ex" xmlns="http://www.w3.org/2000/svg" width="3.119ex" height="2.485ex" role="img" focusable="false" viewBox="0 -893.3 1378.4 1098.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406 158 442Q199 442 224 419T250 355Q248 336 247 334 247 331 231 288T198 191 182 105Q182 62 196 45T238 27Q261 27 281 38T312 61 339 94Q339 95 344 114T358 173 377 247Q415 397 419 404 432 431 462 431 475 431 483 424T494 412 496 403Q496 390 447 193T391-23Q363-106 294-155T156-205Q111-205 77-183T43-117Q43-95 50-80T69-58 89-48 106-45Q150-45 150-87 150-107 138-122T115-142 102-147L99-148Q101-153 118-160T152-167H160Q177-167 186-165 219-156 247-127T290-65 313-9 321 21L315 17Q309 13 296 6T270-6Q250-11 231-11 185-11 150 11T104 82Q103 89 103 113 103 170 138 262T173 379Q173 380 173 381 173 390 173 393T169 400 158 404H154Q131 404 112 385T82 344 65 302 57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="27E8" d="M333-232Q332-239 327-244T313-250Q303-250 296-240 293-233 202 6T110 250 201 494 296 740Q299 745 306 749L309 750Q312 750 313 750 331 750 333 732 333 727 243 489 152 252 152 250T243 11Q333-227 333-232Z"></path></g><g data-mml-node="mi" transform="translate(389,0)"><path data-c="1D461" d="M26 385Q19 392 19 395 19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566 179 586 187 603 197 615 211 624 229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420 330 398 317 385H210L174 240Q135 80 135 68 135 26 162 26 197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145 322 142 319 133 314 117 301 95T267 48 216 6 155-11Q125-11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383 128 385 77 385H26Z"></path></g><g data-mml-node="mo" transform="translate(750,0)"><path data-c="27E9" d="M55 732Q56 739 61 744T75 750Q85 750 92 740 95 733 186 494T278 250 187 6 92-240Q85-250 75-250 67-250 62-245T55-232Q55-227 145 11 236 248 236 250T145 489Q55 727 55 732Z"></path></g></g></g></g></g></svg></mjx-container></span>进行预测，判断用户是否刚刚说过 “activate”。</p><p>注意：这里使用的是单向 RNN，因为如果想要使用双向 RNN，那么就必须等待整个 10 秒的音频被记录下来后从能确定音频片段是都具有 “activate”。</p><p>可以通过以下 4 个步骤来实现模型：</p><ol type="1"><li><p>使用 <code>Conv1D()</code> 来实现卷积层，有 196 个卷积核，每个卷积核的大小为 15(<code>kernel_size=15</code>)，并且步长为 4；</p></li><li><p>用 <code>X = GRU(units = 128, return_sequences = True)(X)</code> 实现 GRU 层，设置 <code>return_sequences=True</code> 确保所有时间步的隐藏状态都会喂给下一层，同时记得添加 Dropout 和 BatchNorm 层；</p></li><li><p>第二个 GRU 层，和上一个步骤类似，只不过多了一个 Dropout 层；</p></li><li><p>创建全连接层：</p><p><code>X = TimeDistributed(Dense(1, activation = "sigmoid"))(X)</code></p><p>这样全连接层后面就会跟一个 Sigmoid 层，TimeDistributed 可以让每个时间步的全连接层的参数一样。</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">model</span>(<span class="params">input_shape</span>):</span><br><span class="line">    X_input = Input(shape = input_shape)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Step 1: CONV layer</span></span><br><span class="line">    X = Conv1D(<span class="number">196</span>, <span class="number">15</span>, strides=<span class="number">4</span>)(X_input)             <span class="comment"># CONV1D</span></span><br><span class="line">    X = BatchNormalization()(X)                         <span class="comment"># Batch normalization</span></span><br><span class="line">    X = Activation(<span class="string">'relu'</span>)(X)                           <span class="comment"># ReLu activation</span></span><br><span class="line">    X = Dropout(<span class="number">0.8</span>)(X)                                 <span class="comment"># dropout (use 0.8)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 2: First GRU Laye</span></span><br><span class="line">    X = GRU(units = <span class="number">128</span>, return_sequences=<span class="literal">True</span>)(X)      <span class="comment"># GRU (use 128 units and return the sequences)</span></span><br><span class="line">    X = Dropout(<span class="number">0.8</span>)(X)                                 <span class="comment"># dropout (use 0.8)</span></span><br><span class="line">    X = BatchNormalization()(X)                         <span class="comment"># Batch normalization</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 3: Second GRU Layer</span></span><br><span class="line">    X = GRU(units = <span class="number">128</span>, return_sequences=<span class="literal">True</span>)(X)      <span class="comment"># GRU (use 128 units and return the sequences)</span></span><br><span class="line">    X = Dropout(<span class="number">0.8</span>)(X)                                 <span class="comment"># dropout (use 0.8)</span></span><br><span class="line">    X = BatchNormalization()(X)                         <span class="comment"># Batch normalization</span></span><br><span class="line">    X = Dropout(<span class="number">0.8</span>)(X)                                 <span class="comment"># dropout (use 0.8)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Step 4: Time-distributed dense layer</span></span><br><span class="line">    X = TimeDistributed(Dense(<span class="number">1</span>, activation = <span class="string">"sigmoid"</span>))(X) <span class="comment"># time distributed  (sigmoid)</span></span><br><span class="line"></span><br><span class="line">    model = Model(inputs = X_input, outputs = X)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> model</span><br><span class="line"></span><br><span class="line">model = model(input_shape = (Tx, n_freq))</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure><h3 id="拟合测试模型">拟合&amp;测试模型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opt = Adam(lr=<span class="number">0.0001</span>, beta_1=<span class="number">0.9</span>, beta_2=<span class="number">0.999</span>, decay=<span class="number">0.01</span>)</span><br><span class="line">model.<span class="built_in">compile</span>(loss=<span class="string">'binary_crossentropy'</span>, optimizer=opt, metrics=[<span class="string">"accuracy"</span>])</span><br><span class="line">model.fit(X, Y, batch_size = <span class="number">5</span>, epochs=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">loss, acc = model.evaluate(X_dev, Y_dev)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"Dev set accuracy = "</span>, acc)</span><br></pre></td></tr></table></figure><p>这个问题的样本不太均衡，因为神经网络很有可能就将所有的数据判断为 0，即不是触发词。因此需要定义更多有用的指标，例如 F1 分数或者 Precision/Recall。</p><h3 id="预测">预测</h3><p>模型训练完成后就可以用来对真实音频进行预测：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">detect_triggerword</span>(<span class="params">filename</span>):</span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    x = graph_spectrogram(filename)</span><br><span class="line">    <span class="comment"># the spectogram outputs (freqs, Tx) and we want (Tx, freqs) to input into the model</span></span><br><span class="line">    x  = x.swapaxes(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    x = np.expand_dims(x, axis=<span class="number">0</span>)</span><br><span class="line">    predictions = model.predict(x)</span><br><span class="line"></span><br><span class="line">    plt.subplot(<span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    plt.plot(predictions[<span class="number">0</span>,:,<span class="number">0</span>])</span><br><span class="line">    plt.ylabel(<span class="string">'probability'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    <span class="keyword">return</span> predictions</span><br></pre></td></tr></table></figure><p>计算出在每个输出步骤检测到 “activate” 这个词的概率，当概率超过某个阈值时，就可以触发鸣响。此外，在检测到触发词后，对于后面连续的许多值，标签可能都接近于 1，但是我们只想响一次，因此可以设置每 75 个输出时间步最多响一次，类似于计算机视觉的非最大抑制作用。</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">chime_file = <span class="string">"audio_examples/chime.wav"</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chime_on_activate</span>(<span class="params">filename, predictions, threshold</span>):</span><br><span class="line">    audio_clip = AudioSegment.from_wav(filename)</span><br><span class="line">    chime = AudioSegment.from_wav(chime_file)</span><br><span class="line">    Ty = predictions.shape[<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># Step 1: Initialize the number of consecutive output steps to 0</span></span><br><span class="line">    consecutive_timesteps = <span class="number">0</span></span><br><span class="line">    <span class="comment"># Step 2: Loop over the output steps in the y</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(Ty):</span><br><span class="line">        <span class="comment"># Step 3: Increment consecutive output steps</span></span><br><span class="line">        consecutive_timesteps += <span class="number">1</span></span><br><span class="line">        <span class="comment"># Step 4: If prediction is higher than the threshold and more than 75 consecutive output steps have passed</span></span><br><span class="line">        <span class="keyword">if</span> predictions[<span class="number">0</span>,i,<span class="number">0</span>] &gt; threshold <span class="keyword">and</span> consecutive_timesteps &gt; <span class="number">75</span>:</span><br><span class="line">            <span class="comment"># Step 5: Superpose audio and background using pydub</span></span><br><span class="line">            audio_clip = audio_clip.overlay(chime, position = ((i / Ty) * audio_clip.duration_seconds)*<span class="number">1000</span>)</span><br><span class="line">            <span class="comment"># Step 6: Reset consecutive output steps to 0</span></span><br><span class="line">            consecutive_timesteps = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">    audio_clip.export(<span class="string">"chime_output.wav"</span>, <span class="built_in">format</span>=<span class="string">'wav'</span>)</span><br></pre></td></tr></table></figure><p></p><h4 id="测试例子">测试例子</h4><p>原音频：</p><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/my_audio.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><p>接下来对该音频进行预测，如果检测到 “activate”，就发出鸣响：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">filename  = <span class="string">"audio_examples/my_audio.wav"</span><span class="string">"</span></span><br><span class="line"><span class="string">prediction = detect_triggerword(filename)</span></span><br><span class="line"><span class="string">chime_on_activate(filename, prediction, 0.5)</span></span><br><span class="line"><span class="string">IPython.display.Audio("</span>./chime_output.wav<span class="string">")</span></span><br></pre></td></tr></table></figure><p><img src="output2.png"></p><center><audio controls="" controlslist="nodownload"><source src="https://randy-1251769892.cos.ap-beijing.myqcloud.com/chime_output.wav" type="audio/mpeg">Your browser does not support the audio element.</audio></center><p>Sigmoid 的输出大于 0.5，表示检测到了触发词，因此添加了鸣响。</p><h2 id="总结">总结</h2><p>终于完成了 Sequence 系列的实验，对触发词检测的流程有了个大致的了解，但是还是感觉神经网络就像炼丹，知道模型的结构这么设置有什么好处，但是还是不知道为什么要这么设置，都是靠直觉？</p><h2 id="参考文献">参考文献</h2><ol type="1"><li>吴恩达. DeepLearning.</li><li>meelo. 短时傅里叶变换解析. https://www.cnblogs.com/meelo/p/5640009.html</li></ol></div><div class="reward-container"><div>疏影横斜水清浅，暗香浮动月黄昏</div><button onclick='var qr=document.getElementById("qr");qr.style.display="none"===qr.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/hexo/images/wechatpay.png" alt="Randy Peng 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/hexo/images/alipay.png" alt="Randy Peng 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong> Randy Peng</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/" title="触发词检测">https://pengzhendong.github.io/hexo/2018/11/15/trigger-word-detection/</a></li><li class="post-copyright-license"><strong>版权声明：</strong> 本博客所有文章除特别声明外，均采用<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i> BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><center><br><div class="addthis_inline_share_toolbox"><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5aa9d6309315fb5e" async="async"></script></div></center><footer class="post-footer"><div class="post-tags"><a href="/hexo/tags/Deep-Learning/" rel="tag"># Deep Learning</a></div><div class="post-nav"><div class="post-nav-item"><a href="/hexo/2018/10/29/fast-fourier-transform/" rel="prev" title="快速傅里叶变换"><i class="fa fa-chevron-left"></i> 快速傅里叶变换</a></div><div class="post-nav-item"><a href="/hexo/2018/11/20/convolution-and-filters/" rel="next" title="卷积与滤波器">卷积与滤波器<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A6%E5%8F%91%E8%AF%8D%E6%A3%80%E6%B5%8B"><span class="nav-number">2.</span> <span class="nav-text">触发词检测</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%90%88%E6%88%90%E5%88%9B%E5%BB%BA%E8%AF%AD%E9%9F%B3%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="nav-number">2.1.</span> <span class="nav-text">数据合成：创建语音数据集</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B3%A2%E5%BD%A2%E5%9B%BE"><span class="nav-number">2.1.1.</span> <span class="nav-text">波形图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A2%E5%BD%A2%E5%9B%BE-1"><span class="nav-number">3.</span> <span class="nav-text">波形图</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%AD%E6%97%B6%E5%82%85%E9%87%8C%E5%8F%B6%E5%8F%98%E6%8D%A2"><span class="nav-number">3.1.</span> <span class="nav-text">短时傅里叶变换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AA%97%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.1.</span> <span class="nav-text">窗函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A3%B0%E8%B0%B1%E5%9B%BE"><span class="nav-number">3.1.2.</span> <span class="nav-text">声谱图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E8%AE%AD%E7%BB%83%E7%A4%BA%E4%BE%8B"><span class="nav-number">4.</span> <span class="nav-text">生成训练示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%85%E5%8A%A9%E5%87%BD%E6%95%B0"><span class="nav-number">4.1.</span> <span class="nav-text">辅助函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E8%AE%AD%E7%BB%83%E6%A0%B7%E6%9C%AC"><span class="nav-number">4.2.</span> <span class="nav-text">生成训练样本</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%B5%8B%E8%AF%95%E9%9B%86"><span class="nav-number">5.</span> <span class="nav-text">开发测试集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.</span> <span class="nav-text">模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.1.</span> <span class="nav-text">构建模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%9F%E5%90%88%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9E%8B"><span class="nav-number">6.2.</span> <span class="nav-text">拟合&amp;测试模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E6%B5%8B"><span class="nav-number">6.3.</span> <span class="nav-text">预测</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BE%8B%E5%AD%90"><span class="nav-number">6.3.1.</span> <span class="nav-text">测试例子</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><span class="nav-number">8.</span> <span class="nav-text">参考文献</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="Randy Peng" src="/hexo/images/avatar.jpg"><p class="site-author-name" itemprop="name">Randy Peng</p><div class="site-description" itemprop="description">路漫漫其修远兮 吾将上下而求索</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/hexo/archives/"><span class="site-state-item-count">35</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-tags"><a href="/hexo/tags/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/pengzhendong" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;pengzhendong" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></span><span class="links-of-author-item"><a href="https://twitter.com/pengzhendong" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;pengzhendong" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i> Twitter</a></span><span class="links-of-author-item"><a href="mailto:275331498@qq.com" title="E-Mail → mailto:275331498@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i> E-Mail</a></span><span class="links-of-author-item"><a href="https://www.facebook.com/pengzhendong" title="FaceBook → https:&#x2F;&#x2F;www.facebook.com&#x2F;pengzhendong" rel="noopener" target="_blank"><i class="fab fa-facebook fa-fw"></i> FaceBook</a></span><span class="links-of-author-item"><a href="https://t.me/pengzhendong" title="Telegram → https:&#x2F;&#x2F;t.me&#x2F;pengzhendong" rel="noopener" target="_blank"><i class="fab fa-telegram fa-fw"></i> Telegram</a></span><span class="links-of-author-item"><a href="https://www.zhihu.com/people/pengzhendong" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;pengzhendong" rel="noopener" target="_blank"><i class="fab fa-leanpub fa-fw"></i> 知乎</a></span><span class="links-of-author-item"><a href="https://weibo.com/qq275331498" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;qq275331498" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i> 微博</a></span><span class="links-of-author-item"><a href="/hexo/about" title="关于 → &#x2F;about"><i class="fa fa-user fa-fw"></i> 关于</a></span></div><hr style="margin-top:20px;margin-bottom:20px"><img src="/images/wechat.png"></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2022</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Randy Peng</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-chart-area"></i></span> <span title="站点总字数">230k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="站点阅读时长">3:29</span></div><script>!function(){function e(e){return e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")}let{app_id:t,app_key:o,server_url:n}={enable:!0,app_id:"YHMwvrTgcfDjOXmiGY3jQ2r5-gzGzoHsz",app_key:"JRfKfM8mRPgxMB9GOSAnix9W",server_url:null,security:!0};function r(n){var r=(e,r,l)=>fetch(`${n}/1.1${r}`,{method:e,headers:{"X-LC-Id":t,"X-LC-Key":o,"Content-Type":"application/json"},body:JSON.stringify(l)});if(CONFIG.page.isPost){if(CONFIG.hostname!==location.hostname)return;!function(t){var o=document.querySelector(".leancloud_visitors"),n=decodeURI(o.id);o.dataset.flagTitle,t("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:n}))).then(e=>e.json()).then(({results:o})=>{if(o.length>0){var r=o[0];e(n).innerText=r.time+1,t("put","/classes/Counter/"+r.objectId,{time:{__op:"Increment",amount:1}}).catch(e=>{console.error("Failed to save visitor count",e)})}else e(n).innerText="Counter not initialized! More info at console err msg.",console.error("ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.")}).catch(e=>{console.error("LeanCloud Counter Error",e)})}(r)}else document.querySelectorAll(".post-title-link").length>=1&&function(t){var o=[...document.querySelectorAll(".leancloud_visitors")].map(e=>decodeURI(e.id));t("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:{$in:o}}))).then(e=>e.json()).then(({results:t})=>{for(let n of o){let o=t.find(e=>e.url===n);e(n).innerText=o?o.time:0}}).catch(e=>{console.error("LeanCloud Counter Error",e)})}(r)}let l="-MdYXbMMI"!==t.slice(-9)?n:`https://${t.slice(0,8).toLowerCase()}.api.lncldglobal.com`;l?r(l):fetch("https://app-router.leancloud.cn/2/route?appId="+t).then(e=>e.json()).then(({api_server:e})=>{r("https://"+e)})}()</script></div></footer></div><script src="/hexo/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script><script src="/hexo/lib/velocity/velocity.min.js"></script><script src="/hexo/lib/velocity/velocity.ui.min.js"></script><script src="/hexo/js/utils.js"></script><script src="/hexo/js/motion.js"></script><script src="/hexo/js/schemes/pisces.js"></script><script src="/hexo/js/next-boot.js"></script><script>!function(){var e,t,o=document.getElementsByTagName("link");if(o.length>0)for(i=0;i<o.length;i++)"canonical"==o[i].rel.toLowerCase()&&o[i].href&&(e=o[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e||(e=window.location.href),function(){var i=e,o=document.referrer;if(!/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi.test(i)){var n="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";o?(n+="?r="+encodeURIComponent(document.referrer),i&&(n+="&l="+i)):i&&(n+="?l="+i),(new Image).src=n}}(window)}()</script><script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/hexo/js/algolia-search.js"></script><script>"undefined"==typeof MathJax?(window.MathJax={loader:{source:{"[tex]/amsCd":"[tex]/amscd","[tex]/AMScd":"[tex]/amscd"}},tex:{inlineMath:{"[+]":[["$","$"]]},tags:"ams"},options:{renderActions:{findScript:[10,e=>{document.querySelectorAll('script[type^="math/tex"]').forEach(t=>{const a=!!t.type.match(/; *mode=display/),n=new e.options.MathItem(t.textContent,e.inputJax[0],a),d=document.createTextNode("");t.parentNode.replaceChild(d,t),n.start={node:d,delim:"",n:0},n.end={node:d,delim:"",n:0},e.math.push(n)})},"",!1],insertedScript:[200,()=>{document.querySelectorAll("mjx-container").forEach(e=>{let t=e.parentNode;"li"===t.nodeName.toLowerCase()&&t.parentNode.classList.add("has-jax")})},"",!1]}}},function(){var e=document.createElement("script");e.src="//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",e.defer=!0,document.head.appendChild(e)}()):(MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset())</script></body></html>